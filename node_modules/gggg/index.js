const requests = require('snekfetch')

async function shorten (longURL, options = {}) {
	const custom_path = encodeURIComponent(options.customPath || '')
	const use_norefs = +!!options.useNorefs
	const long_url = encodeURIComponent(longURL)
	
	const req_body = `custom_path=${custom_path}&use_norefs=${use_norefs}&long_url=${long_url}&app=site&version=1.0`

	const req_headers = {
		'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
	}

	const reply = await requests.post('https://gg.gg/create', {headers: req_headers})
		.send(req_body)

	if (200 > reply.status >= 300) throw new TypeError("URL Creation Failed with a non-2xx status code");
	if (reply.body.toString().trim() === 'http://gg.gg/') throw new TypeError("URL Creation Failed - maybe an invalid parameter");
	const short_url = reply.body.toString()

	return short_url
}

module.exports = {
	shorten
}
